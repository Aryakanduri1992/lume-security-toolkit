# v0.4.0 Implementation Quick Start

## ğŸš€ Ready to Build v0.4.0?

This guide gets you started in 5 minutes.

---

## ğŸ“‹ Prerequisites

âœ… v0.3.0 is working and deployed  
âœ… You've read V0.4.0_SPECIFICATION.md  
âœ… You have 4 weeks available  
âœ… You're ready to code  

---

## ğŸ¯ What You're Building

**In One Sentence**:
> Converting Lume's 7 tools into secure, independent plugins while keeping everything backward compatible.

**Core Principle**:
> Minimal, secure, lean. Not Kubernetes.

---

## ğŸ“ First Steps

### 1. Create Branch
```bash
cd ~/lume-security-toolkit
git checkout -b feature/v0.4.0-plugin-architecture
```

### 2. Create Directory Structure
```bash
mkdir -p lume/plugins
mkdir -p tests/test_plugins
mkdir -p docs
```

### 3. Start with BasePlugin
Create `lume/core/plugin_base.py` first.

This is your foundation. Everything else builds on this.

---

## ğŸ’» Code Template: BasePlugin

```python
"""
lume/core/plugin_base.py
Minimal, secure plugin interface
"""

from abc import ABC, abstractmethod
from typing import List, Dict, Optional
import subprocess

class BasePlugin(ABC):
    """
    Base class for all Lume plugins.
    
    Security: All commands use shell=False
    """
    
    @property
    @abstractmethod
    def name(self) -> str:
        """Plugin name (e.g., 'nmap')"""
        pass
    
    @property
    @abstractmethod
    def command_template(self) -> List[str]:
        """
        Command template with {target} placeholder.
        Example: ["nmap", "-sV", "-T4", "{target}"]
        """
        pass
    
    @abstractmethod
    def validate_target(self, target: str) -> bool:
        """Validate target is safe"""
        pass
    
    @abstractmethod
    def build_command(self, target: str) -> List[str]:
        """Build command from template"""
        pass
    
    @abstractmethod
    def explain(self, target: str) -> Dict[str, str]:
        """
        Return explanation dict with:
        - summary: What the command does
        - impact: What you learn
        - warning: Safety warning
        """
        pass
    
    def execute(self, target: str, dry_run: bool = False) -> Dict:
        """
        Execute command securely.
        This method is FINAL - do not override.
        """
        # Validate
        if not self.validate_target(target):
            return {
                'success': False,
                'error': 'Invalid target'
            }
        
        # Build command
        command = self.build_command(target)
        
        # Dry run
        if dry_run:
            return {
                'success': True,
                'command': ' '.join(command),
                'dry_run': True
            }
        
        # Execute with shell=False (SECURE)
        try:
            result = subprocess.run(
                command,
                shell=False,  # CRITICAL: Never True
                capture_output=True,
                text=True,
                timeout=300
            )
            
            return {
                'success': result.returncode == 0,
                'output': result.stdout,
                'error': result.stderr,
                'command': ' '.join(command)
            }
        except Exception as e:
            return {
                'success': False,
                'error': str(e)
            }
```

**That's it. ~80 lines. Simple, secure, done.**

---

## ğŸ’» Code Template: First Plugin (Nmap)

```python
"""
lume/plugins/nmap.py
Nmap plugin implementation
"""

from lume.core.plugin_base import BasePlugin
from typing import List, Dict
import re

class NmapPlugin(BasePlugin):
    @property
    def name(self) -> str:
        return "nmap"
    
    @property
    def command_template(self) -> List[str]:
        return ["nmap", "-sV", "-T4", "{target}"]
    
    def validate_target(self, target: str) -> bool:
        """Validate target is IP or domain"""
        # IP pattern
        ip_pattern = r'^(?:\d{1,3}\.){3}\d{1,3}$'
        if re.match(ip_pattern, target):
            return True
        
        # Domain pattern
        domain_pattern = r'^[a-z0-9][a-z0-9-]*\.[a-z]{2,}$'
        if re.match(domain_pattern, target.lower()):
            return True
        
        return False
    
    def build_command(self, target: str) -> List[str]:
        """Build nmap command"""
        return [
            arg.replace("{target}", target)
            for arg in self.command_template
        ]
    
    def explain(self, target: str) -> Dict[str, str]:
        return {
            'summary': 'Performed a service and version scan on the target',
            'impact': 'Identified open ports and detected running network services',
            'warning': 'Port scanning may trigger IDS/IPS systems. Ensure authorization.'
        }
```

**That's your first plugin. ~40 lines. Copy this pattern for the other 6.**

---

## ğŸ’» Code Template: Plugin Registry

```python
"""
lume/core/plugin_registry.py
Simple plugin registry
"""

from typing import Dict, Optional, List
from lume.core.plugin_base import BasePlugin

class PluginRegistry:
    """Simple plugin registry"""
    
    _plugins: Dict[str, BasePlugin] = {}
    
    @classmethod
    def register(cls, plugin: BasePlugin) -> None:
        """Register a plugin"""
        if not isinstance(plugin, BasePlugin):
            raise TypeError("Must be BasePlugin instance")
        
        cls._plugins[plugin.name] = plugin
    
    @classmethod
    def get(cls, name: str) -> Optional[BasePlugin]:
        """Get plugin by name"""
        return cls._plugins.get(name)
    
    @classmethod
    def list_all(cls) -> List[str]:
        """List all plugin names"""
        return list(cls._plugins.keys())
    
    @classmethod
    def initialize(cls) -> None:
        """Initialize built-in plugins"""
        from lume.plugins.nmap import NmapPlugin
        # Import and register other plugins
        
        cls.register(NmapPlugin())
        # Register other plugins
```

**That's your registry. ~30 lines. Simple dictionary.**

---

## ğŸ§ª Testing Template

```python
"""
tests/test_plugin_base.py
Test BasePlugin
"""

import pytest
from lume.core.plugin_base import BasePlugin

class MockPlugin(BasePlugin):
    """Mock plugin for testing"""
    
    @property
    def name(self):
        return "mock"
    
    @property
    def command_template(self):
        return ["echo", "{target}"]
    
    def validate_target(self, target):
        return True
    
    def build_command(self, target):
        return ["echo", target]
    
    def explain(self, target):
        return {
            'summary': 'Test',
            'impact': 'Test',
            'warning': 'Test'
        }

def test_plugin_execute():
    """Test plugin execution"""
    plugin = MockPlugin()
    result = plugin.execute("test")
    
    assert result['success'] == True
    assert 'test' in result['output']

def test_plugin_dry_run():
    """Test dry run mode"""
    plugin = MockPlugin()
    result = plugin.execute("test", dry_run=True)
    
    assert result['dry_run'] == True
    assert 'command' in result
```

---

## ğŸ“ Development Workflow

### Day 1: Foundation
1. Create `plugin_base.py`
2. Create `validators.py`
3. Write tests
4. All tests pass âœ…

### Day 2: First Plugin
1. Create `plugins/nmap.py`
2. Test it works
3. Verify security (no shell=True)
4. Document it

### Day 3-7: More Plugins
1. Copy nmap.py pattern
2. Adapt for each tool
3. Test each one
4. Keep it simple

### Week 2: Integration
1. Create legacy adapter
2. Update CLI
3. Test backward compatibility
4. Everything still works âœ…

---

## âœ… Quality Checklist

Before committing any code:

- [ ] No shell=True anywhere
- [ ] All commands are lists, not strings
- [ ] Target validation works
- [ ] Tests pass
- [ ] Code is simple and readable
- [ ] Docstrings present
- [ ] Type hints added

---

## ğŸš¨ Common Mistakes to Avoid

âŒ **DON'T**:
```python
# BAD - String concatenation
command = f"nmap -sV {target}"
subprocess.run(command, shell=True)
```

âœ… **DO**:
```python
# GOOD - List with shell=False
command = ["nmap", "-sV", target]
subprocess.run(command, shell=False)
```

---

âŒ **DON'T**:
```python
# BAD - Complex abstractions
class PluginFactory:
    def create_plugin_with_dependency_injection...
```

âœ… **DO**:
```python
# GOOD - Simple and direct
plugin = NmapPlugin()
PluginRegistry.register(plugin)
```

---

## ğŸ¯ Success Indicators

**You're on track if**:
- Code is simple and readable
- Tests are passing
- No shell=True anywhere
- Backward compatibility works
- You're not over-engineering

**You're off track if**:
- Code is complex
- Tests are failing
- You're adding unnecessary features
- Old commands don't work
- You're building a framework within a framework

---

## ğŸ“š Key Documents

1. **V0.4.0_SPECIFICATION.md** - Complete spec
2. **V0.4.0_IMPLEMENTATION_CHECKLIST.md** - Week-by-week tasks
3. **V0.4.0_QUICK_START.md** - This document

---

## ğŸ†˜ When You're Stuck

1. **Read the spec** - V0.4.0_SPECIFICATION.md
2. **Check v0.3.0 code** - See how it works now
3. **Keep it simple** - Minimal, secure, lean
4. **Test it** - Write a test, make it pass
5. **Ask for review** - Start a new conversation

---

## ğŸ‰ Ready to Start?

### Your First Command:
```bash
cd ~/lume-security-toolkit
git checkout -b feature/v0.4.0-plugin-architecture
touch lume/core/plugin_base.py
# Start coding!
```

### Your First Goal:
**Get BasePlugin working with one test passing.**

That's it. One step at a time.

---

## ğŸ’ª You Got This!

Remember:
- âœ… Keep it simple
- âœ… Security first
- âœ… Test everything
- âœ… One step at a time

**Good luck building v0.4.0!** ğŸš€

---

**Next**: Open `lume/core/plugin_base.py` and start coding.
